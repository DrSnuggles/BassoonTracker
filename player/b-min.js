/*BassoonTracker v0.3.12 by Steffest - build 2021-03-22 - Full source on https://github.com/steffest/BassoonTracker */
var BassoonTracker=function(){function B(e,t){function i(e){(e=0===e?e:e||o.index)<0&&(e=0),o.length<=e&&(e=o.length-1),o.index=e}var o={index:0,_N:!t,goto:function(e){i(e)},jump:function(e){this.goto(this.index+e)},readByte:function(e){i(e);var t=this.dataView.getInt8(this.index);return this.index++,t},writeByte:function(e,t){i(t),this.dataView.setInt8(this.index,e),this.index++},_e:function(e){i(e);var t=this.dataView.getUint8(this.index);return this.index++,t},_f:function(e,t){i(t),this.dataView.setUint8(this.index,e),this.index++},readUint:function(e){i(e);var t=this.dataView.getUint32(this.index,this._N);return this.index+=4,t},writeUint:function(e,t){i(t),this.dataView.setUint32(this.index,e,this._N),this.index+=4},readBytes:function(e,t){i(t);var a=new Uint8Array(e),n=this.index;(e+=n)>this.length&&(e=this.length);for(var r=0;n<e;++n)a.setUint8(r++,this.dataView.getUint8(n));return this.index=e,a},_v:function(e,t){i(t);var a=this.index,n=this.dataView,r="";for((e+=a)>this.length&&(e=this.length);a<e;++a){var o=n.getUint8(a);if(0==o)break;r+=String.fromCharCode(o)}return this.index=e,r},writeString:function(e,t){i(t);for(var a=this.dataView,n=e.length,r=0;r<n;r++)a.setUint8(this.index+r,e.charCodeAt(r));this.index+=n},_I:function(e,t,a,n){i(n),a=a||0;var r=(e=e||"").length;(t=t||1)<r&&(e=e.substr(0,t)),o.writeString(e),o.fill(a,t-r)},_g:function(e){i(e);var t=this.dataView.getUint16(this.index,this._N);return this.index+=2,t},_h:function(e,t){i(t),this.dataView.setUint16(this.index,e,this._N),this.index+=2}};return o.readLong=o.readDWord=o.readUint,o.writeLong=o.writeDWord=o.writeUint,o.readShort=function(e,t){i(t);var a=this.dataView.getInt16(this.index,this._N);return this.index+=2,a},o.clear=function(e){o.fill(0,e)},o.fill=function(e,t){e=e||0,t=t||0;for(var a=0;a<t;a++)o.writeByte(e)},o.isEOF=function(e){return this.length-(e=e||0)<=this.index},e&&(o.buffer=e,o.dataView=new DataView(e),o.length=e.byteLength),o}var e,t,o,D=((t={}).useUrlParams=!0,t.useDropbox=!0,t.showInternalMenu=!0,t.useWebWorkers=!0,t.useInitialLoad=!0,t.init=function(){"object"==typeof HostBridge&&((e=HostBridge).init(),"boolean"==typeof e.useUrlParams&&(t.useUrlParams=e.useUrlParams),"boolean"==typeof e.useDropbox&&(t.useDropbox=e.useDropboxs),"boolean"==typeof e.showInternalMenu&&(t.showInternalMenu=e.showInternalMenu),"boolean"==typeof e.useWebWorkers&&(t.useWebWorkers=e.useWebWorkers))},t.getBaseUrl=function(){return e&&e.getBaseUrl?e.getBaseUrl():"undefined"!=typeof Settings&&Settings.baseUrl||""},t.getRemoteUrl=function(){return e&&e.getRemoteUrl?e.getRemoteUrl():""},t.getVersionNumber=function(){return"undefined"!=typeof versionNumber?versionNumber:e&&e.getVersionNumber?e.getVersionNumber():"dev"},t.getBuildNumber=function(){return"undefined"!=typeof buildNumber?buildNumber:e&&e.getBuildNumber?e.getBuildNumber():(new Date).getTime()},t.signalReady=function(){e&&e.signalReady&&e.signalReady()},t.putFile=function(e,t){},t),S={images:{},audio:{},json:{},arrayBuffer:{}},G=void 0,s=1,F=2,W=1,z=2,X=3,K=4,Z=5,c=7,J=8,Q=9,Y=10,$=11,ee=12,E=13,te=16,ae=17,ne=24,re=26,oe=28,ie=29,f=33,a=36,u=46,se=53,ue=54,_e=55,le=56,ce=1,fe=2,r=1,p=2,d=3,A=1,V=2,pe={C1:{_b:856,_a:"C-1",tune:[907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814]},Cs1:{_b:808,_a:"C#1",tune:[856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768]},D1:{_b:762,_a:"D-1",tune:[808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725]},Ds1:{_b:720,_a:"D#1",tune:[762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684]},E1:{_b:678,_a:"E-1",tune:[720,715,709,704,699,694,689,684,678,674,670,665,660,655,651,646]},F1:{_b:640,_a:"F-1",tune:[678,675,670,665,660,655,651,646,640,637,632,628,623,619,614,610]},Fs1:{_b:604,_a:"F#1",tune:[640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575]},G1:{_b:570,_a:"G-1",tune:[604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543]},Gs1:{_b:538,_a:"G#1",tune:[570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513]},A1:{_b:508,_a:"A-1",tune:[538,535,532,528,524,520,516,513,508,505,502,498,495,491,487,484]},As1:{_b:480,_a:"A#1",tune:[508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457]},B1:{_b:453,_a:"B-1",tune:[480,477,474,470,467,463,460,457,453,450,447,444,441,437,434,431]},C2:{_b:428,_a:"C-2",tune:[453,450,447,444,441,437,434,431,428,425,422,419,416,413,410,407]},Cs2:{_b:404,_a:"C#2",tune:[428,425,422,419,416,413,410,407,404,401,398,395,392,390,387,384]},D2:{_b:381,_a:"D-2",tune:[404,401,398,395,392,390,387,384,381,379,376,373,370,368,365,363]},Ds2:{_b:360,_a:"D#2",tune:[381,379,376,373,370,368,365,363,360,357,355,352,350,347,345,342]},E2:{_b:339,_a:"E-2",tune:[360,357,355,352,350,347,345,342,339,337,335,332,330,328,325,323]},F2:{_b:320,_a:"F-2",tune:[339,337,335,332,330,328,325,323,320,318,316,314,312,309,307,305]},Fs2:{_b:302,_a:"F#2",tune:[320,318,316,314,312,309,307,305,302,300,298,296,294,292,290,288]},G2:{_b:285,_a:"G-2",tune:[302,300,298,296,294,292,290,288,285,284,282,280,278,276,274,272]},Gs2:{_b:269,_a:"G#2",tune:[285,284,282,280,278,276,274,272,269,268,266,264,262,260,258,256]},A2:{_b:254,_a:"A-2",tune:[269,268,266,264,262,260,258,256,254,253,251,249,247,245,244,242]},As2:{_b:240,_a:"A#2",tune:[254,253,251,249,247,245,244,242,240,239,237,235,233,232,230,228]},B2:{_b:226,_a:"B-2",tune:[240,238,237,235,233,232,230,228,226,225,224,222,220,219,217,216]},C3:{_b:214,_a:"C-3",tune:[226,225,223,222,220,219,217,216,214,213,211,209,208,206,205,204]},Cs3:{_b:202,_a:"C#3",tune:[214,212,211,209,208,206,205,203,202,201,199,198,196,195,193,192]},D3:{_b:190,_a:"D-3",tune:[202,200,199,198,196,195,193,192,190,189,188,187,185,184,183,181]},Ds3:{_b:180,_a:"D#3",tune:[190,189,188,187,185,184,183,181,180,179,177,176,175,174,172,171]},E3:{_b:170,_a:"E-3",tune:[180,179,177,176,175,174,172,171,170,169,167,166,165,164,163,161]},F3:{_b:160,_a:"F-3",tune:[170,169,167,166,165,164,163,161,160,159,158,157,156,155,154,152]},Fs3:{_b:151,_a:"F#3",tune:[160,159,158,157,156,155,154,152,151,150,149,148,147,146,145,144]},G3:{_b:143,_a:"G-3",tune:[151,150,149,148,147,146,145,144,143,142,141,140,139,138,137,136]},Gs3:{_b:135,_a:"G#3",tune:[143,142,141,140,139,138,137,136,135,134,133,132,131,130,129,128]},A3:{_b:127,_a:"A-3",tune:[135,134,133,132,131,130,129,128,127,126,125,125,124,123,122,121]},As3:{_b:120,_a:"A#3",tune:[127,126,125,125,123,123,122,121,120,119,118,118,117,116,115,114]},B3:{_b:113,_a:"B-3",tune:[120,119,118,118,117,116,115,114,113,113,112,111,110,109,109,108]}},de={None:{_a:"---"},C0:{_a:"C-0",_b:6848},Cs0:{_a:"C#0",_b:6464},D0:{_a:"D-0",_b:6096},Ds0:{_a:"D#0",_b:5760},E0:{_a:"E-0",_b:5424},F0:{_a:"F-0",_b:5120},Fs0:{_a:"F#0",_b:4832},G0:{_a:"G-0",_b:4560},Gs0:{_a:"G#0",_b:4304},A0:{_a:"A-0",_b:4064},As0:{_a:"A#0",_b:3840},B0:{_a:"B-0",_b:3624},C1:{_a:"C-1",_b:3424},Cs1:{_a:"C#1",_b:3232},D1:{_a:"D-1",_b:3048},Ds1:{_a:"D#1",_b:2880},E1:{_a:"E-1",_b:2712},F1:{_a:"F-1",_b:2560},Fs1:{_a:"F#1",_b:2416},G1:{_a:"G-1",_b:2280},Gs1:{_a:"G#1",_b:2152},A1:{_a:"A-1",_b:2032},As1:{_a:"A#1",_b:1920},B1:{_a:"B-1",_b:1812},C2:{_a:"C-2",_b:1712},Cs2:{_a:"C#2",_b:1616},D2:{_a:"D-2",_b:1524},Ds2:{_a:"D#2",_b:1440},E2:{_a:"E-2",_b:1356},F2:{_a:"F-2",_b:1280},Fs2:{_a:"F#2",_b:1208},G2:{_a:"G-2",_b:1140},Gs2:{_a:"G#2",_b:1076},A2:{_a:"A-2",_b:1016},As2:{_a:"A#2",_b:960},B2:{_a:"B-2",_b:906},C3:{_a:"C-3",_b:856},Cs3:{_a:"C#3",_b:808},D3:{_a:"D-3",_b:762},Ds3:{_a:"D#3",_b:720},E3:{_a:"E-3",_b:678},F3:{_a:"F-3",_b:640},Fs3:{_a:"F#3",_b:604},G3:{_a:"G-3",_b:570},Gs3:{_a:"G#3",_b:538},A3:{_a:"A-3",_b:508},As3:{_a:"A#3",_b:480},B3:{_a:"B-3",_b:453},C4:{_a:"C-4",_b:428},Cs4:{_a:"C#4",_b:404},D4:{_a:"D-4",_b:381},Ds4:{_a:"D#4",_b:360},E4:{_a:"E-4",_b:339},F4:{_a:"F-4",_b:320},Fs4:{_a:"F#4",_b:302},G4:{_a:"G-4",_b:285},Gs4:{_a:"G#4",_b:269},A4:{_a:"A-4",_b:254},As4:{_a:"A#4",_b:240},B4:{_a:"B-4",_b:226.5,_k:226},C5:{_a:"C-5",_b:214},Cs5:{_a:"C#5",_b:202},D5:{_a:"D-5",_b:190.5,_k:190},Ds5:{_a:"D#5",_b:180},E5:{_a:"E-5",_b:169.5,_k:170},F5:{_a:"F-5",_b:160},Fs5:{_a:"F#5",_b:151},G5:{_a:"G-5",_b:142.5,_k:143},Gs5:{_a:"G#5",_b:134.5,_k:135},A5:{_a:"A-5",_b:127},As5:{_a:"A#5",_b:120},B5:{_a:"B-5",_b:113.25,_k:113},C6:{_a:"C-6",_b:107},Cs6:{_a:"C#6",_b:101},D6:{_a:"D-6",_b:95.25,_k:95},Ds6:{_a:"D#6",_b:90},E6:{_a:"E-6",_b:84.75,_k:85},F6:{_a:"F-6",_b:80},Fs6:{_a:"F#6",_b:75.5,_k:75},G6:{_a:"G-6",_b:71.25,_k:71},Gs6:{_a:"G#6",_b:67.25,_k:67},A6:{_a:"A-6",_b:63.5,_k:63},As6:{_a:"A#6",_b:60},B6:{_a:"B-6",_b:56.625,_k:56},C7:{_a:"C-7",_b:53.5,_k:53},Cs7:{_a:"C#7",_b:50.5,_k:50},D7:{_a:"D-7",_b:47.625,_k:47},Ds7:{_a:"D#7",_b:45},E7:{_a:"E-7",_b:42.375,_k:42},F7:{_a:"F-7",_b:40},Fs7:{_a:"F#7",_b:37.75,_k:37},G7:{_a:"G-7",_b:35.625,_k:35},Gs7:{_a:"G#7",_b:33.625,_k:33},A7:{_a:"A-7",_b:31.75,_k:31},As7:{_a:"A#7",_b:30},B7:{_a:"B-7",_b:28.3125,_k:28},C8:{_a:"C-8",_b:26.75},Cs8:{_a:"C#8",_b:25.25},D8:{_a:"D-8",_b:23.8125},Ds8:{_a:"D#8",_b:22.5},E8:{_a:"E-8",_b:21.1875},F8:{_a:"F-8",_b:20},Fs8:{_a:"F#8",_b:18.875},G8:{_a:"G-8",_b:17.8125},Gs8:{_a:"G#8",_b:16.8125},A8:{_a:"A-8",_b:15.875},As8:{_a:"A#8",_b:15},B8:{_a:"B-8",_b:14.15625},C9:{_a:"C-9",_b:13.375},Cs9:{_a:"C#9",_b:12.625},D9:{_a:"D-9",_b:11.90625},Ds9:{_a:"D#9",_b:11.25},E9:{_a:"E-9",_b:10.59375},F9:{_a:"F-9",_b:10},Fs9:{_a:"F#9",_b:9.4375},G9:{_a:"G-9",_b:8.90625},Gs9:{_a:"G#9",_b:8.40625},A9:{_a:"A-9",_b:7.9375},As9:{_a:"A#9",_b:7.5},B9:{_a:"B-9",_b:7.078125},C10:{_a:"C-10",_b:6.6875},Cs10:{_a:"C#10",_b:6.3125},D10:{_a:"D-10",_b:5.953125},Ds10:{_a:"D#10",_b:5.625},E10:{_a:"E-10",_b:5.296875},F10:{_a:"F-10",_b:5},Fs10:{_a:"F#10",_b:4.71875},G10:{_a:"G-10",_b:4.453125},Gs10:{_a:"G#10",_b:4.203125},A10:{_a:"A-10",_b:3.96875},As10:{_a:"A#10",_b:3.75},B10:{_a:"B-10",_b:3.5390625},C11:{_a:"C-11",_b:3.34375},Cs11:{_a:"C#11",_b:3.15625},D11:{_a:"D-11",_b:2.9765625},Ds11:{_a:"D#11",_b:2.8125},E11:{_a:"E-11",_b:2.6484375},F11:{_a:"F-11",_b:2.5},Fs11:{_a:"F#11",_b:2.359375},G11:{_a:"G-11",_b:2.2265625},Gs11:{_a:"G#11",_b:2.1015625},A11:{_a:"A-11",_b:1.984375},As11:{_a:"A#11",_b:1.875},B11:{_a:"B-11",_b:1.76953125},OFF:{_a:"OFF",_b:0}},me=145,ve=1,he=2,ge={unrollLoops:!1,unrollShortLoops:!1,sustainKeyboardNotes:!1,useHover:!0,keyboardTable:"qwerty",vubars:!0,stereoSeparation:p,_B:!0,loadInitialFile:!0},be=(o={},{on:function(e,t){var a=o[e];return a||(o[e]=a=[]),a.push(t),a.length},off:function(e,t){var a=o[e];a&&(a[t-1]=void 0)},_o:function(e,t){var a=o[e];if(a){var n,r=a.length;for(n=0;n<r;n++)a[n]&&a[n](t,e)}}}),ye=function(){var A,i,s,u,S,F={};window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var V,M,B=[],_=p,a=0,D=[[],[],[]],G=0,I=4143.569,l={volume:!0,panning:!0,high:!0,mid:!0,low:!0,lowPass:!0,reverb:!0,distortion:!1};return AudioContext&&(A=new AudioContext),F.init=function(e,t){function a(){var e=FilterChain(l);e.output().connect(u),B.push(e)}if(F.context=A=e=e||A,e){var n,r;V=!!ye.context.createStereoPanner,M="undefined"!=typeof Editor,r=t,(s=(n=e).createGain()).gain.setValueAtTime(1,0),s.connect(r||n.destination),(i=n.createGain()).connect(s),F.setMasterVolume(1),(u=n.createBiquadFilter()).type="lowpass",u.frequency.setValueAtTime(2e4,0),u.connect(i),F.masterVolume=i,F.cutOffVolume=s,F.lowPassfilter=u;var o=Ae.getTrackCount();for(B=[],S=0;S<o;S++)a();F.filterChains=B,F.usePanning=V,be.on(c,function(e){void 0!==e.track&&B[e.track]&&B[e.track].volumeValue(e.mute?0:70)}),be.on(ne,function(e){for(S=B.length;S<e;S++)a();be._o(f,e),F.setStereoSeparation(_)}),be.on(oe,function(e){F.setStereoSeparation()})}},F.enable=function(){s.gain.setValueAtTime(1,0),F.cutOff=!1},F.disable=function(){s.gain.setValueAtTime(0,0),F.cutOff=!0;D.forEach(function(e,t){e.forEach(function(e){e.gain.cancelScheduledValues(0),e.gain.setValueAtTime(0,0)}),D[t]=[]})},F.checkState=function(){A&&"suspended"===A.state&&A.resume&&A.resume()},F.playSample=function(e,t,a,n,r,o,i){var s;s=A,F.enable(),t=t||428,void 0===n&&(n=M?Editor.getCurrentTrack():0),o=o||A.currentTime,i===me&&(a=0);var u,_,l,c=Ae._t(e),f=t,p=0;if(c){var d,m,v=0,h=0;a=void 0===a?100*c.sample.volume/64:a,p=(c.sample.panning||0)/128,Ae._j()?Ae._s?t-=c._G()/2:c._G()&&(t=F._E(i,c._G())):c._G()&&(t=F._F(t,c._G())),m=F._P(t);var g=1;c.sample.data.length?(h=c.sample.data.length,r&&r.offset&&(h<=r.offset.value&&(r.offset.value=h-1),v=r.offset.value/s.sampleRate),d=s.createBuffer(1,h,s.sampleRate),g=m/s.sampleRate):(d=s.createBuffer(1,1,s.sampleRate),v=0);var b=d.getChannelData(0);for(S=0;S<h;S++)b[S]=c.sample.data[S];I=m;var y=s.createBufferSource();y.buffer=d;var T=s.createGain();if(T.gain.value=a/100,T.gain.setValueAtTime(a/100,o),c.sample.loop.enabled&&2<c.sample.loop.length&&(ge.unrollLoops||(y.loop=!0,y.loopStart=c.sample.loop.start/s.sampleRate,y.loopEnd=(c.sample.loop.start+c.sample.loop.length)/s.sampleRate)),c._c.enabled||c._d.enabled||c.hasVibrato()){var w=c.noteOn(o),k=y;w.volume&&(y.connect(u=w.volume),k=u),w.panning&&(k.connect(_=w.panning),k=_),l=w.scheduled,k.connect(T)}else y.connect(T);var C=ye.context.createGain();if(C.gain.setValueAtTime(0,o),C.gain.linearRampToValueAtTime(1,o+.01),T.connect(C),V){var P=ye.context.createStereoPanner();P.pan.setValueAtTime(p,o),C.connect(P),P.connect(B[n].input())}else C.connect(B[n].input());y.playbackRate.value=g;y.start(o+0,v);var x={source:y,volume:T,panning:P,_c:u,_d:_,_X:C,_Y:a,_V:a,_U:t,basePeriod:f,noteIndex:i,startPlaybackRate:g,sampleRate:m,_q:e,effects:r,track:n,time:o,scheduled:l};return D[G].push(T),be._o(E,x),x}return{}},F.playSilence=function(){if(A){var e=A.createBufferSource();e.connect(i);try{e.start()}catch(e){}}},F.playRaw=function(e,t){if(A&&e&&e.length){var a;a=A.createBuffer(1,e.length,A.sampleRate);var n=t/audioContext.sampleRate,r=A.createBufferSource();r.buffer=a,r.loop=!0,r.playbackRate.value=n,r.connect(i),r.start()}},F.setStereoSeparation=function(e){var t,a=Ae.getTrackCount();if(Ae._j())t=0;else switch(_=e=e||_){case d:t=0,ge.stereoSeparation=d;break;case r:t=1,ge.stereoSeparation=r;break;default:t=.5,ge.stereoSeparation=p}for(S=0;S<a;S++){var n=B[S];n&&n.panningValue(S%4==0||S%4==3?-t:t)}},F.getPrevSampleRate=function(){return I},F.context=A,F.getSemiToneFrom=function(e,t,a){var n=e;if(a&&(e=(e=F._GBasePeriod(e,a))||n),t){var r=Te[e];if(r){var o=Ce.indexOf(r._a),i=Ce[o+t];if(i){var s=ke[i];s&&(n=s._b,a&&(n=F._F(n,a)))}}}return n},F.getNearestSemiTone=function(e,t){var a=8;if(t){var n=Ae._t(t);n&&n.sample.finetune&&(a+=n.sample.finetune)}var r=1e5,o=e;for(var i in pe)if(pe.hasOwnProperty(i)){var s=pe[i].tune[a],u=Math.abs(s-e);u<r&&(r=u,o=s)}return o},F._F=function(e,t){var a=e,n=Te[e];if(n&&n.tune){var r=8+t;0<=r&&r<n.tune.length&&(a=n.tune[r])}return a},F._E=function(e,t){if(e===me)return 1;var a=Pe[e],n=0<t?Pe[e+1]:Pe[e-1];if(a&&n){var r=Math.abs(n._b-a._b)/127;return a._b-r*t}return a?a._b:1e5},F._GBasePeriod=function(e,t){var a=e,n=we[t];return n&&(a=n[e]),a},F._P=function(e){return Ae._j()?Ae._s?8363*Math.pow(2,(4608-e)/768):3579364/e:3546895/e},F.limitAmigaPeriod=function(e){return e=Math.max(e,113),e=Math.min(e,856)},F.setAmigaLowPassFilter=function(e,t){u.frequency.setValueAtTime(e?2e3:2e4,t)},F.setMasterVolume=function(e,t){e*=.7,i.gain.setValueAtTime(a,t=t||A.currentTime),i.gain.linearRampToValueAtTime(e,t+.02),a=e},F.slideMasterVolume=function(e,t){i.gain.linearRampToValueAtTime(e*=.7,t=t||A.currentTime),a=e},F.getLastMasterVolume=function(){return a/.7},F.clearScheduledNotesCache=function(){2<++G&&(G=0),D[G]=[]},F._r={sine:function(e,t,a,n){return e+Math.sin(t*a*.8)*n*1.7},saw:function(e,t,a,n){var r=1-Math.abs(t*a/7%1);return e+(r=(r=2*r-1)*n*-2)},square:function(e,t,a,n){var r=Math.sin(t*a)<=0?-1:1;return e+(r=r*n*2)},sawInverse:function(e,t,a,n){var r=Math.abs(t*a/7%1);return e+(r=(r=2*r-1)*n*-2)}},F}();!function(r,o,e){function i(a,e){if(!o[a]){if(!r[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var n=o[a]={exports:{}};r[a][0].call(n.exports,function(e){var t=r[a][1][e];return i(t||e)},n,n.exports)}return o[a].exports}for(var s="function"==typeof require&&require,t=0;t<e.length;t++)i(e[t])}({1:[function(e,t,a){var n=e("./lib/WAAClock");t.exports=n,"undefined"!=typeof window&&(window.WAAClock=n)},{"./lib/WAAClock":2}],3:[function(e,t,a){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var a=[];return window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<a.length&&a.shift()())},!0),function(e){a.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],2:[function(e,t,a){var n=e("__browserify_process");if("undefined"!=typeof window&&!AudioContext)throw new Error("This browser doesn't seem to support web audio API");function r(e,t,a){this.clock=e,this.func=a,this.repeatTime=null,this._n=o,this._m=i,this._armed=!1,this._latestTime=null,this._earliestTime=null,this.schedule(t)}var o=.1,i=.001;r.prototype.clear=function(){return this.clock._removeEvent(this),this},r.prototype.repeat=function(e){if(0===e)throw new Error("delay cannot be 0");return this.repeatTime=e,this},r.prototype.tolerance=function(e){return"number"==typeof e.late&&(this._n=e.late),"number"==typeof e.early&&(this._m=e.early),this._update(),this},r.prototype.isRepeated=function(){return null!==this.repeatTime},r.prototype.schedule=function(e){this._armed=!0,this.deadline=e,this._update(),this._earliestTime<=this.clock.context.currentTime&&(this.clock._removeEvent(this),this._execute())},r.prototype._execute=function(){this._armed=!1,this.clock.context.currentTime<this._latestTime?this.func(this):be&&be._o(u),!1===this._armed&&this.isRepeated()&&this.schedule(this.deadline+this.repeatTime)},r.prototype._update=function(){this._latestTime=this.deadline+this._n,this._earliestTime=this.deadline-this._m,this.clock._removeEvent(this),this.clock._insertEvent(this)};var s=t.exports=function(e,t){this._m=(t=t||{})._m||i,this._n=t._n||o,this.context=e,this._events=[],this._started=!1};s.prototype.setTimeout=function(e,t){return this._createEvent(e,this._absTime(t))},s.prototype.callbackAtTime=function(e,t){return this._createEvent(e,t)},s.prototype.timeStretch=function(a,e,n){var r=this.context.currentTime;return e.forEach(function(e){e.isRepeated()&&e.repeat(e.repeatTime*n);var t=a+n*(e.deadline-a);if(e.isRepeated())for(;t-e._m<=r;)t+=e.repeatTime;e.schedule(t)}),e},s.prototype.start=function(){if(!1===this._started){var e=this;this._started=!0,this._events=[];this._clockNode=this.context.createScriptProcessor(256,1,1),this._clockNode.connect(this.context.destination),this._clockNode.onaudioprocess=function(){n.nextTick(function(){e._tick()})}}},s.prototype.stop=function(){!0===this._started&&(this._started=!1,this._clockNode.disconnect())},s.prototype._tick=function(){for(var e=this._events.shift();e&&e._earliestTime<=this.context.currentTime;)e._execute(),e=this._events.shift();e&&this._events.unshift(e)},s.prototype._createEvent=function(e,t){var a=new r(this,t,e);return a.tolerance({late:this._n,early:this._m}),a},s.prototype._insertEvent=function(e){this._events.splice(this._indexByTime(e._earliestTime),0,e)},s.prototype._removeEvent=function(e){var t=this._events.indexOf(e);-1!==t&&this._events.splice(t,1)},s.prototype._indexByTime=function(e){for(var t,a=0,n=this._events.length;a<n;)t=Math.floor((a+n)/2),this._events[t]._earliestTime<e?a=t+1:n=t;return a},s.prototype._absTime=function(e){return e+this.context.currentTime},s.prototype._relTime=function(e){return e-this.context.currentTime}},{__browserify_process:3}]},{},[1]),FilterChain=function(e){function a(){var e,t,a,n;if(i=o,h&&(_=_||((e=A.createBiquadFilter()).type="highshelf",e.frequency.value=3200,e.gain.value=P,e),i.connect(_),i=_),g&&(l=l||((t=A.createBiquadFilter()).type="peaking",t.frequency.value=1e3,t.Q.value=.5,t.gain.value=C,t),i.connect(l),i=l),b&&(c=c||((a=A.createBiquadFilter()).type="lowshelf",a.frequency.value=320,a.gain.value=k,a),i.connect(c),i=c),y&&(f=f||((n=A.createBiquadFilter()).type="lowpass",n.frequency.value=5e3,n),i.connect(f),i=f),T&&(p=p||A.createConvolver(),(d=d||A.createGain()).gain.value=0,i.connect(d),d.connect(p),s=p),w){var r=A.createWaveShaper();r.curve=function(e){for(var t,a="number"==typeof e?e:50,n=new Float32Array(44100),r=Math.PI/180,o=0;o<44100;++o)n[o]=(3+a)*(t=2*o/44100-1)*20*r/(Math.PI+a*Math.abs(t));return n}(400),r.oversample="4x"}v&&(m=m||ye.context.createStereoPanner(),i.connect(m),i=m),u=u||A.createGain(),i.connect(u),s&&s.connect(u),i=u}var t={};e=e||{volume:!0,panning:!0};var o,i,s,u,_,l,c,f,p,d,m,n=(e={volume:!0,panning:!0}).volume,v=e.panning&&ye.context.createStereoPanner,h=e.high,g=e.mid,b=e.low,y=e.lowPass,T=e.reverb,w=e.distortion,k=0,C=0,P=0,r=70,x=0,A=ye.context;return(o=A.createGain()).gain.value=1,i=o,t.lowValue=function(e){if(b){if(void 0!==e){c.gain.value=20*(k=e)}return k}},t.midValue=function(e){if(g){if(void 0!==e){l.gain.value=20*(C=e)}return C}},t.highValue=function(e){if(h){if(void 0!==e){_.gain.value=20*(P=e)}return P}},t.lowPassFrequencyValue=function(e){if(y){var t=ye.context.sampleRate/2,a=Math.log(t/40)/Math.LN2,n=Math.pow(2,a*(e-1));f.frequency.value=t*n}},t.lowPassQualityValue=function(e){y&&(f.Q.value=30*e)},t.reverbValue=function(e){if(T){if(!p.buffer){var t=S.audio["data/reverb/sportcentre.m4a"];if(t)p.buffer=t;else M().load(["data/reverb/sportcentre.m4a"],F,function(){p.buffer=S.audio["data/reverb/sportcentre.m4a"]})}var a=parseInt(e)/100;d.gain.value=a*a}},t.volumeValue=function(e){if(n){if(void 0!==e){var t=(r=e)/100;u.gain.value=t*t}return r}},t.panningValue=function(e,t){if(v)return void 0!==e&&m.pan.setValueAtTime(x=e,t||ye.context.currentTime),x},t.setState=function(e,t){o.disconnect(),_&&_.disconnect(),l&&l.disconnect(),c&&c.disconnect(),f&&f.disconnect(),d&&d.disconnect(),m&&m.disconnect(),s=void 0,"high"===e&&(h=!!t),"mid"===e&&(g=!!t),"low"===e&&(b=!!t),"lowPass"===e&&(y=!!t),"reverb"===e&&(T=!!t),"panning"===e&&(v=!!t&&ye.context.createStereoPanner),a()},t.input=function(){return o},t.output=function(){return i},a(),t.volumeValue(r),t};var n,i,_,Te={},we={},ke={},Ce=[],Pe=[],xe=[],Ae=function(){function e(s){s=s||0,(n=n||new WAAClock(ye.context)).start(),ye.enable(),G&&G.setStatus("Playing"),U=[],q=[];var u=(b=g.patterns[s]).length,_={},l=0,c=ye.context.currentTime+.1,f=.2,p=b,d=T;F=[],y=n.setTimeout(function(e){1<l&&y.repeat(f=1);var t=e.deadline+f;for(ye.clearScheduledNotesCache();c<t;){if(_.pause&&!Ae.autoPlay){if(!_.pasuseHandled){var a=c-ye.context.currentTime;0<a&&setTimeout(function(){j.pause(),j._x(6)},Math.round(1e3*a)+100),_.pasuseHandled=!0}return}if(j.setStateAtTime(c,{patternPos:l,songPos:d}),_.patternDelay){for(_.patternDelay--,V=0;V<C;V++)v(V,c);c+=N*O}else if(_=m(l,c,p,d),c+=N*O,u<=++l||_._W){if(_.positionBreak&&_._A==d||(U=[],q=[]),l=0,Ae.getPlayType()==ce){var n=_.positionBreak?_._A:++d;g.length<=n&&(n=g._L?g._L-1:0,be._o(se)),g.length<=n&&(n=0),(p=g.patterns[s=g.patternTable[d=n]])||(p=h(),g.patterns[s]=p),u=p.length,_._W&&p.length<(l=_._y||0)&&(l=0)}else _._W&&P<(l=_._y||0)&&(l=0);be._o(ue,c-N*O)}}for(V=0;V<C;V++){var r=H[V];if(r&&r.time&&r.scheduled){var o=j._t(r._q);if(r.scheduled.volume&&r.scheduled.volume<=c+f){var i=o.scheduleEnvelopeLoop(r._c,r.scheduled.volume,2);r.scheduled.volume+=i}r.scheduled.panning&&r.scheduled.panning<=c+f&&(i=o.scheduleEnvelopeLoop(r._d,r.scheduled.panning,2),r.scheduled.panning+=i)}}},.01).repeat(f).tolerance({early:.1})}function m(e,t,a,n){for(var r,o=(a=a||b)[e],i=C,s={},u=0;u<i;u++)(_=o[u])&&_.effect&&15===_.effect&&(_._i<32?(Ae._x(_._i),0===_._i&&(s.pause=!0)):Ae.setBPM(_._i));for(u=0;u<i;u++){var _=o[u];if(_){var l={position:n,step:e},c=t;if(S)c+=(Math.random()*S*2-S)/1e3;(r=f(_,u,c,l))._W&&(s._W=!0,s._y=r._y||0),r.positionBreak&&(s.positionBreak=!0,s._y=r._y||0,s._A=r._A||0),r.patternDelay&&(s.patternDelay=r.patternDelay)}}for(u=0;u<i;u++)v(u,t);return s}function f(e,t,a,n){var r=100,o={},i=e._u,s=e._b,u=e.index;s&&!i&&(i=H[t]._Z,r="number"==typeof H[t]._V?H[t]._V:r,ge._B&&i&&L[t].offset&&L[t].offset._u===i&&(o.offset=L[t].offset)),"number"==typeof e._u&&(M=j._t(e._u))&&(r=M.sample.volume/64*100,ge._B&&(L[t].offset=L[t].offset||{},L[t].offset.value=0,L[t].offset._u=e._u));var _=r,l=!0;if("number"==typeof i&&(M=j._t(i)),u&&j._j())if(97===u&&(u=me),u===me){var c=M||j._t(H[t]._Z);r=_=c?c.noteOff(a,H[t]):0,l=!1}else if(M&&(M.setSampleForNoteIndex(u),M.sample.relativeNote&&(u+=M.sample.relativeNote)),j._s)s=7680-64*(u-1);else{var f=Pe[u];f&&(s=f._b)}var p,d,m=e._i,v={};if(e._T&&j._j()){var h=e._T;if(p=h>>4,d=15&h,15<h&&h<=80)o.volume={value:r=_=(h-16)/64*100};else switch(p){case 6:o.fade={value:-1*d*100/64};break;case 7:o.fade={value:100*d/64};break;case 8:o.fade={value:100*-d/64,fine:!0};break;case 9:o.fade={value:100*d/64,fine:!0};break;case 10:case 11:break;case 12:o.panning={value:17*(h-192),slide:!1};break;case 13:o.panning={value:h,slide:!0}}}switch(e.effect){case 0:if(m){p=m>>4,d=15&m;var g=0;if(M=M||j._t(H[t]._Z),j._j()){if(M){var b=u||H[t].noteIndex,y=M._O(b,!0);u===me?o.arpeggio=L[t].arpeggio:(o.arpeggio={root:y,interval1:y-M._O(b+p,!0),interval2:y-M._O(b+d,!0),step:1},L[t].arpeggio=o.arpeggio)}}else y=s||H[t]._U,M&&(g=M._G())&&(y=ye._F(y,g)),o.arpeggio={root:y,interval1:y-ye.getSemiToneFrom(y,p,g),interval2:y-ye.getSemiToneFrom(y,d,g),step:1}}e._u&&(o.volume={value:r});break;case 1:m*=-1,j._j()&&!m&&L[t].slideUp&&(m=L[t].slideUp.value),o.slide={value:m},L[t].slideUp=o.slide;break;case 2:j._j()&&!m&&L[t].slideDown&&(m=L[t].slideDown.value),o.slide={value:m},L[t].slideDown=o.slide;break;case 3:l=!1;var T=s;if(j._j()&&u===me&&(T=0),H[t]._Z&&(i=H[t]._Z),T&&i)(M=j._t(i))&&M._G()&&(T=j._j()?M._O(u,!0):ye._F(T,M._G()));(C=L[t].slide)&&(m=m||C.value),o.slide={value:m,target:T=T||L[t].defaultSlideTarget,canUseGlissando:!0,resetVolume:!!e._u,volume:r},L[t].slide=o.slide,e._u&&(o.volume={value:r});break;case 4:e._u&&(H[t]._Y&&(o.volume={value:_}),H[t]._l=0);var w=(p=m>>4)*N/64,k=L[t]._p;0==p&&k&&(w=k.freq),0==(d=15&m)&&k&&(d=k.amplitude),o._p={amplitude:d,freq:w},L[t]._p=o._p;break;case 5:var C;l=!1,(T=s)&&i&&(M=j._t(i))&&M._G()&&(T=j._j()?ye._E(u,M._G()):ye._F(T,M._G())),m=1,(C=L[t].slide)&&(T=T||(C.target||0),m=C.value),o.slide={value:m,target:T},L[t].slide=o.slide,e._u&&(o.volume={value:r}),(m=e._i)&&(e._i<16?m*=-1:m=e._i>>4,o.fade={value:m=100*m/64,resetOnStep:!!e._u},L[t].fade=o.fade);break;case 6:e._u&&(H[t]._Y&&(o.volume={value:_}),H[t]._l=0),e._i?(e._i<16?m*=-1:m=15&e._i,o.fade={value:m=100*m/64},L[t].fade=o.fade):Ae._j()&&L[t].fade&&(o.fade=L[t].fade),L[t]._p&&(o._p=L[t]._p);break;case 7:s&&!e._u&&(H[t]._Y&&(o.volume={value:_}),H[t].tremoloTimer=0);var P=d=15&m,x=(w=(p=m>>4)*N/64,L[t].tremolo);0==p&&x&&(w=x.freq),0==d&&x&&(P=x.amplitude),o.tremolo={amplitude:P,freq:w},L[t].tremolo=o.tremolo;break;case 8:o.panning={value:m,slide:!1};break;case 9:!(m<<=8)&&L[t].offset&&(m=L[t].offset.stepValue||L[t].offset.value||0);var A=m;ge._B&&!e._u&&L[t].offset&&(m+=L[t].offset.value),o.offset={value:m,stepValue:A},L[t].offset=L[t].offset||{},L[t].offset.value=o.offset.value,L[t].offset.stepValue=o.offset.stepValue,ge._B&&(e._u&&(L[t].offset._u=e._u),s&&(L[t].offset.value+=A)),e._u&&(o.volume={value:r});break;case 10:if(e._i<16?m*=-1:m=e._i>>4,m=100*m/64,!e._i){var S=L[t].fade;S&&(m=S.value)}o.fade={value:m,resetOnStep:!!e._u},j._j()&&(L[t].fade=o.fade);break;case 11:Ae.autoPlay||(v._W=!0,v.positionBreak=!0,v._A=e._i,v._y=0);break;case 12:o.volume={value:_=e._i/64*100};break;case 13:v._W=!0,v._y=10*(p=m>>4)+(d=15&m);break;case 14:var F=m>>4,V=15&m;switch(F){case 0:j._j()||ye.setAmigaLowPassFilter(!V,a);break;case 1:!(V*=-1)&&L[t].fineSlide&&(V=L[t].fineSlide.value),o.slide={value:V,fine:!0},L[t].fineSlide=o.slide;break;case 2:!V&&L[t].fineSlide&&(V=L[t].fineSlide.value),o.slide={value:V,fine:!0},L[t].fineSlide=o.slide;break;case 3:L[t].glissando=!!V;break;case 4:switch(V){case 1:E=ye._r.saw;break;case 2:E=ye._r.square;break;case 3:case 4:E=ye._r.sine;break;case 5:E=ye._r.saw;break;case 6:E=ye._r.square;break;case 7:default:E=ye._r.sine}break;case 5:if(i){var M=j._t(i);o.fineTune={original:M._G(),_u:M},M.setFineTune(V)}break;case 6:V?(q[t]=q[t]||0,q[t]<V?(q[t]++,v._W=!0,v.positionBreak=!0,v._A=n.position,v._y=U[t]||0):q[t]=0):U[t]=n.step;break;case 7:switch(V){case 1:R=ye._r.saw;break;case 2:R=ye._r.square;break;case 3:case 4:R=ye._r.sine;break;case 5:R=ye._r.saw;break;case 6:R=ye._r.square;break;case 7:default:R=ye._r.sine}break;case 8:break;case 9:V&&(o.reTrigger={value:V});break;case 10:o.fade={value:V=100*V/64,fine:!0};break;case 11:o.fade={value:-(V=100*V/64),fine:!0};break;case 12:V?V<N&&(o.cutNote={value:V}):l=!1;break;case 13:V&&(V<N?a+=O*V:l=!1);break;case 14:v.patternDelay=V}break;case 15:e._i<32?Ae._x(e._i,a):Ae.setBPM(e._i);break;case 16:m=Math.min(m,64),j.isPlugin||ye.setMasterVolume(m/64,a);break;case 17:p=m>>4,d=15&m;var B=64*ye.getLastMasterVolume(),D=0;if(p){var G=a+p*O;D=p*(N-1)}else d&&(G=a+d*O,D=-d*(N-1));D&&(m=(B+D)/64,m=Math.max(0,m),m=Math.min(1,m),ye.slideMasterVolume(m,G));break;case 20:j._j()&&(r=_=(c=M||j._t(H[t]._Z))?c.noteOff(a,H[t]):0,l=!1);break;case 21:case 25:break;case 27:o.reTrigger={value:e._i}}return l&&i&&s&&(I(t,a),H[t]={},M&&(H[t]=M.play(u,s,_,t,o,a)),L[t].defaultSlideTarget=H[t]._U),i&&(H[t]._Z=i,o.fineTune&&o.fineTune._u&&o.fineTune._u.setFineTune(o.fineTune.original||0)),M&&M.hasVibrato()&&(H[t]._Q=!0),H[t].effects=o,H[t].note=e,v}function I(e,t){try{if(H[e].source){var a=H[e].volume.gain;a.setValueAtTime(H[e]._V/100,t-.002),a.linearRampToValueAtTime(0,t),H[e].source.stop(t+.02)}}catch(e){}}function x(e,t){var a=j._t(e._q);if(a){var n=-a._p.rate/40,r=a._p.depth/8;if(j._s&&(r*=4),e._l=e._l||0,a._p.sweep&&e._l<a._p.sweep)r*=1-(a._p.sweep-e._l)/a._p.sweep;var o=a._D()(t,e._l,n,r);return e._l++,o}return t}function v(e,t){var a=H[e],n=a.effects;if(a&&n){var r,o=!1;if(a.startVibratoTimer=a._l||0,a.resetPeriodOnStep&&a.source)j.setPeriodAtTime(a,c=a.currentPeriod||a._U,t),a.resetPeriodOnStep=!1;if(n.volume){var i=n.volume.value;a.volume&&a.volume.gain.setValueAtTime(i/100,t),a._V=i}if(n.panning&&(255===(r=n.panning.value)&&(r=254),a.panning&&a.panning.pan.setValueAtTime((r-127)/127,t)),n.fade){var s;r=n.fade.value;var u=1;s=n.fade.resetOnStep?a._Y:a._V;var _=N;n.fade.fine&&(u=0,_=1);for(var l=u;l<_;l++)a.volume&&(a.volume.gain.setValueAtTime(s/100,t+l*O),s+=r,s=Math.max(s,0),s=Math.min(s,100));a._V=s}if(n.slide&&a.source){var c=m=a.currentPeriod||a._U;_=N;n.slide.fine&&(_=2);var f=n.slide.value;if(j._j()&&j._s&&(f=4*n.slide.value),r=Math.abs(f),j._j()&&n.slide.resetVolume&&(a._X||a._c)){var p=j._t(a._q);p&&p.resetVolume(t,a)}a._l=a.startVibratoTimer;for(l=1;l<_;l++){n.slide.target?(L[e].defaultSlideTarget=n.slide.target,c<n.slide.target?n.slide.target<(c+=r)&&(c=n.slide.target):(c-=r)<n.slide.target&&(c=n.slide.target)):(c+=f,L[e].defaultSlideTarget&&(L[e].defaultSlideTarget+=f)),j._j()||(c=ye.limitAmigaPeriod(c));var d=c;n.slide.canUseGlissando&&L[e].glissando&&(d=ye.getNearestSemiTone(c,a._q)),d!==a.currentPeriod&&(a.currentPeriod=c,a._Q&&j._j()&&(c=x(a,c),o=!0),j.setPeriodAtTime(a,d,t+l*O))}}if(n.arpeggio&&a.source){var m=a.currentPeriod||a._U;a.resetPeriodOnStep=!0,a._l=a.startVibratoTimer;for(l=0;l<N;l++){var v=l%3;0==v&&(c=m),1==v&&n.arpeggio.interval1&&(c=m-n.arpeggio.interval1),2==v&&n.arpeggio.interval2&&(c=m-n.arpeggio.interval2),a._Q&&j._j()&&(c=x(a,c),o=!0),j.setPeriodAtTime(a,c,t+l*O)}}if(n._p||a._Q&&!o){n._p=n._p||{freq:0,amplitude:0};var h=n._p.freq,g=n._p.amplitude;if(j._j()&&j._s&&(g*=4),a._l=a._l||0,a.source){a.resetPeriodOnStep=!0,m=a.currentPeriod||a._U,a._l=a.startVibratoTimer;for(l=0;l<N;l++)c=E(m,a._l,h,g),a._Q&&j._j()?(c=x(a,c),o=!0):a._l++,j.setPeriodAtTime(a,c,t+l*O)}}if(n.tremolo){h=n.tremolo.freq,g=n.tremolo.amplitude;if(a.tremoloTimer=a.tremoloTimer||0,a.volume){var b=a._Y;for(l=0;l<N;l++)(b=R(b,a.tremoloTimer,h,g))<0&&(b=0),100<b&&(b=100),a.volume.gain.setValueAtTime(b/100,t+l*O),a._V=b,a.tremoloTimer++}}if(n.cutNote&&(a.volume&&a.volume.gain.setValueAtTime(0,t+n.cutNote.value*O),a._V=0),n.reTrigger){var y=a._q,T=a._U;i=a._Y;for(var w=a.noteIndex,k=n.reTrigger.value||1,C=k;C<N;){var P=t+C*O;I(e,P),H[e]=ye.playSample(y,T,i,e,n,P,w),C+=k}}}}function i(){G&&G.setInfo(g.title),g.channels&&j.setTrackCount(g.channels),w=a=r=t=void 0,j.setCurrentSongPosition(0),j._C(0),j._S(1),j.clearEffectCache(),be._o(re,g),be._o(te,g)}function s(){be._o(le,0),be._o(_e,0),j._x(6),j.setBPM(125),R=E=ye._r.sine,L=[],H=[];for(var e=0;e<C;e++)H.push({}),L.push({});j._s=!1,j._R(ve,!0),j.isPlugin||ye.setMasterVolume(1),ye.setAmigaLowPassFilter(!1,0),"undefined"!=typeof StateManager&&StateManager.clear()}function h(){for(var e=[],t=0;t<P;t++){var a,n=[];for(a=0;a<C;a++)n.push(Ve());e.push(n)}return e}for(var n,g,r,a,t,b,E,R,y,j={},o=!(j.isMaster=!0),u=!1,_=[],l=1,c=0,p=0,d=ce,T=0,w=0,k=125,N=6,O=2.5/k,C=4,P=64,A=ve,S=0,H=[],L=[],F=[],U=[],q=[],V=0;V<C;V++)H.push({}),L.push({});j.init=function(t){for(var e=-8;e<8;e++)we[e]={};for(var a in pe)if(pe.hasOwnProperty(a)){var n=pe[a];if(Ce.push((ke[(Te[n._b]=n)._a]=n)._a),n.tune)for(e=-8;e<8;e++){we[e][n.tune[e+8]]=n._b}}var r=0;for(a in de)if(de.hasOwnProperty(a)){var o=de[a];o._b||(o._b=1),Pe.push(o),xe[o._b]=r,o._k&&(xe[o._k]=r),r++}t&&(D.init(),ye.init(t.audioContext,t.audioDestination),t.plugin&&(j.isPlugin=!0,G.initPlugin(t),"boolean"==typeof t.isMaster&&(j.isMaster=t.isMaster),t.handler&&(be.on(ee,function(e){t.handler(ee,e)}),be.on(le,function(e){t.handler(le,e)}),be.on($,function(e){t.handler($,e)}),be.on(_e,function(e){t.handler(_e,e)}),be.on(ue,function(e){t.handler(ue,e)}))))},j.setMaster=function(e){j.isMaster=e},j.isMaster=function(){return!!j.isMaster},j._S=function(e){if(g._us[e])r!=(l=e)&&be._o(W,l),r=l;else if(e<=j.getMaxInstruments()){for(var t=g._us.length,a=e;t<=a;t++)j.setInstrument(t,Fe());var n=[];for(t=1;t<=a;t++){n.push({label:t+" "+(g._us[t]||{_a:""})._a,data:t}),be._o(ie,n)}r!=(l=e)&&be._o(W,l),r=l}},j.getCurrentInstrumentIndex=function(){return l},j.getCurrentInstrument=function(){return _[l]},j.getMaxInstruments=function(){return j._j()?128:31},j.setCurrentPattern=function(e){(b=g.patterns[c=e])||(b=h(),g.patterns[c]=b),P=b.length,a!=c&&be._o(z,c),a=c},j.getCurrentPattern=function(){return c},j.getCurrentPatternData=function(){return b},j.updatePatternTable=function(e,t){be._o(K,g.patternTable[e]=t),e==T&&(a=void 0,Ae.setCurrentPattern(t))},j._C=function(e){t!=(p=e)&&be._o(X,{current:p,prev:t}),t=p},j.getCurrentPatternPos=function(){return p},j.moveCurrentPatternPos=function(e){var t=p+e,a=P-1;t<0&&(t=a),a<t&&(t=0),j._C(t)},j.getCurrentSongPosition=function(){return T},j.setCurrentSongPosition=function(e,t){(T=e)!=w&&(be._o(Y,T),g.patternTable&&j.setCurrentPattern(g.patternTable[T]),w=T,t&&j.isPlaying()&&(j.stop(),j.togglePlay()))},j.addToPatternTable=function(e,t){void 0===e&&(e=g.length),t=t||0,e==g.length&&(g.patternTable[e]=t,g.length++),be._o(te,g),be._o(K)},j.removeFromPatternTable=function(e){g.length<2||(void 0===e&&(e=g.length-1),e==g.length-1&&(g.patternTable[e]=0,g.length--),T==g.length&&j.setCurrentSongPosition(T-1),be._o(te,g),be._o(K))},j.setPlayType=function(e){be._o(Q,d=e)},j.getPlayType=function(){return d},j.playSong=function(){j.stop(),ye.checkState(),j.setPlayType(ce),u=!0,e(c),be._o(J,u)},j.playPattern=function(){j.stop(),ye.checkState(),p=0,j.setPlayType(fe),u=!0,e(c),be._o(J,u)},j.stop=function(){n&&n.stop(),ye.disable(),j.isPlugin||ye.setMasterVolume(1),G&&(G.setStatus("Ready"),Input.clearInputNotes()),j.clearEffectCache();for(var e=0;e<C;e++)if(H[e].source)try{H[e].source.stop()}catch(e){}be._o(J,u=!1)},j.pause=function(){n&&n.stop(),be._o(J,u=!1)},j.togglePlay=function(){j.isPlaying()?j.stop():d==fe?j.playPattern():j.playSong()},j.getProperties=function(){return{ticksPerStep:N,tickTime:O}},j.playPatternStep=m,j.cutNote=I,j.setBPM=function(e,t){var a=t&&t.isMaster;j.isMaster||a?(n&&n.timeStretch(ye.context.currentTime,[y],k/e),a||be._o(le,k),O=2.5/(k=e),be._o(ee,k)):be._o(le,e)},j.getBPM=function(){return k},j._x=function(e,t){j.isMaster||t&&t.isMaster?be._o($,N=e):be._o(_e,e)},j.getAmigaSpeed=function(){return N},j.getSwing=function(){return S},j.setSwing=function(e){S=e},j.getPatternLength=function(){return P},j.setPatternLength=function(e){var t=g.patterns[c].length;if(t!==(P=e)){if(t<P)for(var a=t;a<P;a++){var n,r=[];for(n=0;n<C;n++)r.push(Ve());g.patterns[c].push(r)}else g.patterns[c]=g.patterns[c].splice(0,P),P<=p&&j._C(P-1);be._o(z,c)}},j.getTrackCount=function(){return C},j.setTrackCount=function(e){C=e;for(var t=H.length;t<C;t++)H.push({});for(t=L.length;t<C;t++)L.push({});be._o(ne,C)},j.toggleRecord=function(){j.stop(),be._o(Z,o=!o)},j.isPlaying=function(){return u},j.isRecording=function(){return o},j.setStateAtTime=function(e,t){F.push({time:e,state:t})},j.getStateAtTime=function(e){for(var t=void 0,a=0,n=F.length;a<n;a++){if(!(F[0].time<e))return t;t=F.shift().state}return t},j.getTimeStates=function(){return F},j.setPeriodAtTime=function(e,t,a){if(t=Math.max(t,1),j._j()&&j._s)var n=8363*Math.pow(2,(4608-t)/768)/ye.context.sampleRate;else n=e._U/t,n*=e.startPlaybackRate;e.source.playbackRate.setValueAtTime(n,a),e.source.playbackRate.setValueAtTime(n,a+.005)},j.load=function(i,s,u,t){(i=i||"demomods/StardustMemories.mod").indexOf("://")<0&&0!==i.indexOf("/")&&(i=D.getBaseUrl()+i),G&&(G.setInfo(""),G.setLoading());function a(e){t&&!D.useInitialLoad||j.processFile(e,_,function(e){if(G&&G.setStatus("Ready"),e){var t="",a="";if("string"==typeof i){if(0<i.indexOf("modarchive.org")){var n=i.split("moduleid=")[1];g.file_a=n.split("#")[1]||n,a="modArchive",t="https://modarchive.org/index.php?request=view_by_moduleid&query="+(n=(n=n.split("#")[0]).split("&")[0]),be._o(te,g)}0<i.indexOf("modules.pl")&&(n=i.split("modules.pl/")[1],g.file_a=n.split("#")[1]||n,a="modules.pl",t="http://www.modules.pl/?id=module&mod="+(n=(n=n.split("#")[0]).split("&")[0]),be._o(te,g))}G&&G.setInfo(g.title,a,t)}if(G&&e&&!s){var r=window.location.path_a,o=r.substring(r.lastIndexOf("/")+1);window.history.pushState&&window.history.pushState({},_,o+"?file="+encodeURIComponent(i))}e&&M(s),u&&u()})}var e,n,r,_="";"string"==typeof i?(_=i.substr(i.lastIndexOf("/")+1),e=i,n=function(e){a(e)},(r=new XMLHttpRequest).open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(e){var t=r.response;t&&200===r.status?n&&n(t):"undefined"!=typeof Editor&&n&&n(!1)},r.send(null)):(_=i._a||"",s=!0,a(i.buffer||i))};var M=function(e){var t=function(e){if(window.location.getParameter)return window.location.getParameter(e);if(location.search)for(var t=location.search.substring(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]&&n[0]==e)return n[1]||!0}}("autoplay");Ae.autoPlay&&(t="1"),!G&&e&&(t="1"),"true"!=t&&"1"!=t||Ae.playSong()};return j.handleUpload=function(e){if(e.length){var t=e[0],a=new FileReader;a.onload=function(){j.processFile(a.result,t._a,function(e){G&&G.setStatus("Ready")})},a.readAsArrayBuffer(t)}},j.processFile=function(e,n,r){var t=!1,a=new B(e,!0),o=Se.detect(a,n);o&&"ZIP"==o._a&&(G&&G.setStatus("Extracting Zip file",!0),zip.workerScriptsPath="script/src/lib/zip/",zip.useWebWorkers=D.useWebWorkers,zip.createReader(new zip.ArrayBufferReader(e),function(e){var t,a=0;e.getEntries(function(e){e&&e.length&&e.forEach(function(e){a<e.uncompressedSize&&(a=e.uncompressedSize,t=e)}),t?t.getData(new zip.ArrayBufferWriter,function(e){e&&e.byteLength&&j.processFile(e,n,r)}):r&&r(!1)})},function(e){r&&r(!1)})),o.isMod&&o.loader&&(t=!0,j.isPlaying()&&j.stop(),s(),(g=o.loader().load(a,n)).file_a=n,i()),o.isSample&&"undefined"!=typeof Editor&&Editor.importSample(a,n),r&&r(t)},j.getSong=function(){return g},j._ts=function(){return _},j._t=function(e){return _[e]},j.setInstrument=function(e,t){_[t._q=e]=t},j.clearEffectCache=function(){L=[];for(var e=0;e<C;e++)L.push({})},j.clearInstruments=function(e){if(g){var t=[],a=e||g._us.length-1;for(_=[],V=1;V<=a;V++)j.setInstrument(V,Fe()),t.push({label:V+" ",data:V});g._us=_,be._o(ie,t),be._o(W,l)}},j._R=function(e,t){function a(){A=e,ge._B=!j._j(),be._o(oe,e)}e===ve&&!t&&32<Ae._ts().length?G.showDialog("WARNING !!!//This file has more than 31 _us./If you save this file as .MOD, only the first 31 _us will be included.//Are you sure you want to continue?",function(){a()},function(){}):a()},j.getTrackerMode=function(){return A},j._j=function(){return A===he},j.new=function(){s(),g={patterns:[],_us:[]},j.clearInstruments(31),g.typeId="M.K.",g.title="new song",g.length=1,g._L=0,g.patterns.push(h());for(var e=[],t=0;t<128;++t)e[t]=0;g.patternTable=e,i()},j.clearInstrument=function(){_[l]=Fe(),be._o(W,l),be._o(ae,l)},j.getFileName=function(){return g.file_a||(g.title?g.title.replace(/ /g,"-").replace(/\W/g,"")+".mod":"new.mod")},j._s=!0,j}(),M=function(){var o={load:function(e,t,a){o.type=t||s,o.loadCount=0,o.max=e.length,o.next=a;for(var n=0,r=e.length;n<r;n++)i(e[n])}},i=function(t){if(o.type==s){var e=new Image;e.onload=function(){S.images[t]=this,++o.loadCount==o.max&&o.next&&o.next()},e.onerror=function(){alert("BufferLoader: XHR error")},e.src=t}if(o.type==F){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("GET",t,!0),a.onload=function(){ye.context.decodeAudioData(a.response,function(e){e?(S.audio[t]=e,++o.loadCount==o.max&&o.next&&o.next()):alert("error decoding file data: "+t)},function(e){})},a.onerror=function(){alert("BufferLoader: XHR error")},a.send()}};return o},Se=((n={}).get=function(e,t){n.ajax({url:e,success:function(e){t(e)},error:function(e){t(void 0,e)}})},n.json=function(e,t){void 0===t&&(t=function(){}),n.ajax({url:e,cache:!1,datatype:"json",headers:[{key:"Accept",value:"application/json"}],success:function(e){t(e)},error:function(e){t(void 0,e)}})},n.html=function(e,t){n.ajax({url:e,cache:!1,datatype:"html",success:function(e){t(e)},error:function(e){t(void 0,e)}})},n.ajax=function(t){var a=new XMLHttpRequest;t.error=t.error||function(){t.success(!1)},"jsonp"===t.datatype&&t.error(a);var e=t.url;if("boolean"==typeof t.cache&&!t.cache&&D.useUrlParams){var n=(new Date).getTime();e+=0<e.indexOf("?")?"&r="+n:"?r="+n}var r=t.method||"GET";a.onreadystatechange=function(){if(!(a.readyState<4)&&4===a.readyState)if(200!==a.status&&201!==a.status)t.error(a);else{var e=a.responseText;"json"===t.datatype&&(e=JSON.parse(e)),"html"===t.datatype&&((e=document.createElement("div")).innerHTML=a.responseText),t.success(e)}},a.ontimeout=function(e){},a.open(r,e,!0),a.timeout=t.timeout||3e4,t.headers&&t.headers.forEach(function(e){a.setRequestHeader(e.key,e.value)});var o=t.data||"";"POST"===r&&t.data&&"form"===t.datatype&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(o)},_={unknown:{_a:"UNKNOWN"},unsupported:{_a:"UNSUPPORTED"},mod_ProTracker:{_a:"PROTRACKER",isMod:!0,loader:function(){return l()}},mod_SoundTracker:{_a:"SOUNDTRACKER",isMod:!0,loader:function(){return m()}},mod_FastTracker:{_a:"FASTTRACKER",isMod:!0,loader:function(){return v()}},sample:{_a:"SAMPLE",isSample:!0},zip:{_a:"ZIP"}},(i={}).detect=function(r,e){function o(e){return e<128}var i=r.length,t="";if("Extended Module: "==(t=r._v(17,0)))return _.mod_FastTracker;if(1100<i&&(t=r._v(4,1080)),"M.K."==t)return _.mod_ProTracker;if("M!K!"==t)return _.mod_ProTracker;if("M&K!"==t)return _.mod_ProTracker;if("FLT4"==t)return _.mod_ProTracker;if("2CHN"==t)return _.mod_ProTracker;if("6CHN"==t)return _.mod_ProTracker;if("8CHN"==t)return _.mod_ProTracker;if("10CH"==t)return _.mod_ProTracker;if("12CH"==t)return _.mod_ProTracker;if("14CH"==t)return _.mod_ProTracker;if("16CH"==t)return _.mod_ProTracker;if("18CH"==t)return _.mod_ProTracker;if("20CH"==t)return _.mod_ProTracker;if("22CH"==t)return _.mod_ProTracker;if("24CH"==t)return _.mod_ProTracker;if("26CH"==t)return _.mod_ProTracker;if("28CH"==t)return _.mod_ProTracker;if("30CH"==t)return _.mod_ProTracker;if("32CH"==t)return _.mod_ProTracker;var a="";return e&&4<e.length&&(a=e.substr(e.length-4)),".wav"==(a=a.toLowerCase())||".mp3"==a||".iff"==a?_.sample:".zip"==a||"PK"==r._v(2,0)?_.zip:e&&0<=e.indexOf(".")&&1624<i&&function(){r.goto(0);for(var e=0;e<20;e++)if(!o(r.readByte()))return;for(var t=0,a=0,n=0;n<15;n++){for(e=0;e<22;e++)if(!o(r.readByte()))return;if(r.jump(-22),"st-"==r._v(22).toLowerCase().substr(0,3)&&(a+=10),20<a)return 1;t+=r._g(),r.jump(6)}return!(i<2*t+1624)}()?_.mod_SoundTracker:_.sample},i),l=function(){var e={load:function(e,t){Ae._R(ve,!0),Ae._s=!1,Ae.clearInstruments(31);var a={patterns:[],_L:1},n=4;a.typeId=e._v(4,1080),a.title=e._v(20,0),"2CHN"===a.typeId&&(n=2),"6CHN"===a.typeId&&(n=6),"8CHN"===a.typeId&&(n=8),"10CH"===a.typeId&&(n=10),"12CH"===a.typeId&&(n=12),"14CH"===a.typeId&&(n=14),"16CH"===a.typeId&&(n=16),"18CH"===a.typeId&&(n=18),"20CH"===a.typeId&&(n=20),"22CH"===a.typeId&&(n=22),"24CH"===a.typeId&&(n=24),"26CH"===a.typeId&&(n=26),"28CH"===a.typeId&&(n=28),"30CH"===a.typeId&&(n=30),"32CH"===a.typeId&&(n=32),a.channels=n;var r=0;for(c=1;c<=31;++c){var o=e._v(22),i=e._g(),s=Fe();s._a=o,s.sample.length=s.sample.realLen=i<<1;var u=e._e();16<u&&(u%=16),7<u&&(u-=16),s.setFineTune(u),s.sample.volume=e._e(),s.sample.loop.start=e._g()<<1,s.sample.loop.length=e._g()<<1,s.sample.loop.enabled=2<s.sample.loop.length,s.sample.loop.type=A,s.pointer=r,r+=s.sample.length,s.setSampleIndex(0),Ae.setInstrument(c,s)}a._us=Ae._ts(),e.goto(950),a.length=e._e(),e.jump(1);for(var _=[],l=0,c=0;c<128;++c)_[c]=e._e(),l<_[c]&&(l=_[c]);for(a.patternTable=_,e.goto(1084),c=0;c<=l;++c){for(var f=[],p=0;p<64;p++){var d,m=[];for(d=0;d<n;d++){var v=Ve(),h=e.readUint();v.setPeriod(h>>16&4095),v.effect=h>>8&15,v._u=h>>24&240|h>>12&15,v._i=255&h,m.push(v)}for(d=n;d<Ae.getTrackCount();d++)m.push(Ve());f.push(m)}a.patterns.push(f)}var g=[];for(c=1;c<=31;c++)if(s=Ae._t(c)){var b=s.sample.length;for(2<s.sample.loop.length&&ge.unrollShortLoops&&s.sample.loop.length<1e3&&(b=Math.min(b,s.sample.loop.start+s.sample.loop.length),s.sample.length=b),j=0;j<b;j++){var y=e.readByte();j<2&&(y=0),s.sample.data.push(y/127)}if((ge.unrollShortLoops||ge.unrollLoops)&&2<s.sample.loop.length){var T=Math.ceil(4e4/s.sample.loop.length)+1;ge.unrollLoops||(T=0);var w=!1,k=0;ge.unrollShortLoops&&s.sample.loop.length<1600&&(T=Math.floor(1e3/s.sample.loop.length),w=!0);for(var C=0;C<T;C++){var P=s.sample.loop.start,x=P+s.sample.loop.length;for(j=P;j<x;j++)s.sample.data.push(s.sample.data[j]);k+=s.sample.loop.length}w&&k&&(s.sample.loop.length+=k,s.sample.length+=k)}g.push({label:c+" "+s._a,data:c})}return be._o(ie,g),a}};return e},m=function(){var e={load:function(e,t){Ae._R(ve,!0),Ae._s=!1,Ae.clearInstruments(15);var a={patterns:[],_L:1};a.typeId="ST",a.channels=4,a.title=e._v(20,0);var n=0;for(_=1;_<=15;++_){var r=e._v(22),o=e._g(),i=Fe();i._a=r,i.sample.length=i.realLen=o<<1,i.sample.volume=e._g(),i.setFineTune(0),i.sample.loop.start=e._g(),i.sample.loop.length=e._g()<<1,i.sample.loop.enabled=2<i.sample.loop.length,i.sample.loop.type=A,i.pointer=n,n+=i.sample.length,i.setSampleIndex(0),Ae.setInstrument(_,i)}a._us=Ae._ts(),e.goto(470),a.length=e._e(),a.speed=e._e();for(var s=[],u=0,_=0;_<128;++_)s[_]=e._e(),u<s[_]&&(u=s[_]);for(a.patternTable=s,e.goto(600),_=0;_<=u;++_){for(var l=[],c=0;c<64;c++){var f,p=[];for(f=0;f<4;f++){var d={},m=e.readUint();d._b=m>>16&4095,d.effect=m>>8&15,d._u=m>>24&240|m>>12&15,d._i=255&m,p.push(d)}for(f=4;f<Ae.getTrackCount();f++)p.push({note:0,effect:0,_u:0,_i:0});l.push(p)}a.patterns.push(l)}var v=[];for(_=1;_<=15;_++)if(i=Ae._t(_)){var h=i.sample.length;for(j=0;j<h;j++){var g=e.readByte();j<2&&(g=0),i.sample.data.push(g/127)}v.push({label:_+" "+i._a,data:_})}return be._o(ie,v),a}};return e},v=function(){var x={load:function(e,t){function a(e){for(e.points=[],g=0;g<12;g++)e.points.push(e.raw.slice(2*g,2*g+2));return 1&e.type&&(e.enabled=!0),2&e.type&&(e.sustain=!0),4&e.type&&(e.loop=!0),e}Ae._R(he,!0),Ae.clearInstruments(1);var n={},r={patterns:[],_us:[]};e._N=!0,e.goto(17),r.title=e._v(20),e.jump(1),n.trackerName=e._v(20),n.trackerVersion=e.readByte(),n.trackerVersion=e.readByte()+"."+n.trackerVersion,n.headerSize=e.readDWord(),n.songlength=e._g(),n._L=e._g(),n.numberOfChannels=e._g(),n.numberOfPatterns=e._g(),n.numberOfInstruments=e._g(),n.flags=e._g(),Ae._s=n.flags%2==1,n.defaultTempo=e._g(),n.defaultBPM=e._g();for(var o=[],i=0,s=0;s<n.songlength;++s)o[s]=e._e(),i<o[s]&&(i=o[s]);r.patternTable=o,r.length=n.songlength,r.channels=n.numberOfChannels,r._L=n._L+1;var u=60+n.headerSize;for(e.goto(u),s=0;s<n.numberOfPatterns;s++){var _=[],l={};l.headerSize=e.readDWord(),l.packingType=e._e(),l.patternLength=e._g(),l.patternSize=e._g(),e.goto(u+=l.headerSize);for(var c=0;c<l.patternLength;c++){var f,p=[];for(f=0;f<n.numberOfChannels;f++){var d=Ve(),m=e._e();128&m?(1&m&&d.setIndex(e._e()),2&m&&(d._u=e._e()),4&m&&(d._T=e._e()),8&m&&(d.effect=e._e()),16&m&&(d._i=e._e())):(d.setIndex(m),d._u=e._e(),d._T=e._e(),d.effect=e._e(),d._i=e._e()),p.push(d)}_.push(p)}e.goto(u+=l.patternSize),r.patterns.push(_)}var v=[];for(s=1;s<=n.numberOfInstruments;++s){var h=Fe();try{if(h.filePosition=e.index,h.headerSize=e.readDWord(),h._a=e._v(22),h.type=e._e(),h._K=e._g(),h.samples=[],(h._M=0)<h._K){h._M=e.readDWord(),h._M=Math.max(h._M,40),200<h._M&&(h._M=40);for(var g=0;g<96;g++)h._z.push(e._e());for(g=0;g<24;g++)h._c.raw.push(e._g());for(g=0;g<24;g++)h._d.raw.push(e._g());h._c.count=e._e(),h._d.count=e._e(),h._c._H=e._e(),h._c._w=e._e(),h._c._J=e._e(),h._d._H=e._e(),h._d._w=e._e(),h._d._J=e._e(),h._c.type=e._e(),h._d.type=e._e(),h._p.type=e._e(),h._p.sweep=e._e(),h._p.depth=Math.min(e._e(),15),h._p.rate=e._e(),h.fadeout=e._g(),h.reserved=e._g(),h._c=a(h._c),h._d=a(h._d)}}catch(e){}if(e.goto(u+=h.headerSize),0===h._K){var b=I();h.samples.push(b)}else{if(e.isEOF(1))break;for(var y=0;y<h._K;y++)(b=I()).length=e.readDWord(),b.loop.start=e.readDWord(),b.loop.length=e.readDWord(),b.volume=e._e(),b.finetuneX=e.readByte(),b.type=e._e(),b.panning=e._e()-128,b.relativeNote=e.readByte(),b.reserved=e.readByte(),b._a=e._v(22),b.bits=8,h.samples.push(b),e.goto(u+=h._M);for(y=0;y<h._K;y++)if((b=h.samples[y]).length){u+=b.length,16&b.type&&(b.bits=16,b.type^=16,b.length>>=1,b.loop.start>>=1,b.loop.length>>=1),b.loop.type=b.type||0,b.loop.enabled=!!b.loop.type;var T=b.length,w=0;if(16===b.bits)for(var k=0;k<T;k++){var C=e.readShort()+w;C<-32768?C+=65536:32767<C&&(C-=65536),b.data.push((w=C)/32768)}else for(k=0;k<T;k++)(C=e.readByte()+w)<-128?C+=256:127<C&&(C-=256),b.data.push((w=C)/127);if(b.loop.type===V){var P=b.data.slice(b.loop.start,b.loop.start+b.loop.length);b.data=b.data.slice(0,b.loop.start+b.loop.length),b.data=b.data.concat(P.reverse()),b.loop.length=2*b.loop.length,b.length=b.loop.start+b.loop.length}e.goto(u)}}h.setSampleIndex(0),Ae.setInstrument(s,h),v.push({label:s+" "+h._a,data:s})}return be._o(ie,v),r._us=Ae._ts(),Ae.setBPM(n.defaultBPM),Ae._x(n.defaultTempo),x.validate(r),r},validate:function(e){function r(e,t){var a=!0;if(e.points&&e.points[0])if(0===e.points[0][0])for(var n=0,r=1;r<e.count;r++){var o=e.points[r];o&&n<o[0]?n=o[0]:a=!1}else a=!1;else a=!1;return a?e:"volume"===t?{raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6}:{raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5}}e._us.forEach(function(e){e._c=r(e._c,"volume"),e._d=r(e._d,"panning");for(var t=e.samples.length-1,a=0,n=e._z.length;a<n;a++)e._z[a]=Math.min(e._z[a],t)})}};return x},Fe=function(){function i(e,t,a){var n=Ae.getProperties().tickTime,r=e.sustain?e._H+1:e.count;e._w=Math.min(e._w,e.count-1),e._J=Math.min(e._J,e.count-1);var o=e.loop&&e._w<e._J;e.sustain&&e._H<=e._w&&(o=!1),o&&(r=e._J+1);var i=0;if(t.gain)var s=t.gain,u=0,_=64;else s=t.pan,_=u=32;s.setValueAtTime((e.points[0][1]-u)/_,a);for(var l=1;l<r;l++){var c=e.points[l];s.linearRampToValueAtTime((c[1]-u)/_,a+(i=c[0]*n))}return!!o&&p.scheduleEnvelopeLoop(t,a,2,i)}var p={type:"sample",_a:"",_q:0,sampleIndex:-1,fadeout:128,data:[]};return p.samples=[I()],p.sample=p.samples[0],p._c={raw:[],enabled:!1,points:[[0,48],[10,64],[20,40],[30,18],[40,28],[50,18]],count:6},p._d={raw:[],enabled:!1,points:[[0,32],[20,40],[40,24],[60,32],[80,32]],count:5},p._p={},p._z=[],p.play=function(e,t,a,n,r,o){return Ae._j()&&(t=p._O(e)),ye.playSample(p._q,t,a,n,r,o,e)},p.noteOn=function(e){var t,a,n={};if(p._c.enabled){t=ye.context.createGain();var r=p._c,o=i(r,t,e);o&&(n.volume=e+o)}return p._d.enabled&&ye.usePanning&&(a=ye.context.createStereoPanner(),(o=i(r=p._d,a,e))&&(n.panning=e+o)),p._p.rate&&p._p.depth&&(n.ticks=0,n._p=e,n._pFunction=p._D()),{volume:t,panning:a,scheduled:n}},p.noteOff=function(e,t){function a(){t.volume.gain.cancelScheduledValues(e),t._X.gain.cancelScheduledValues(e),t._c&&t._c.gain.cancelScheduledValues(e),t._d&&t._d.pan.cancelScheduledValues(e),t.scheduled=void 0}if(t&&t.volume){if(Ae._j()){var n=Ae.getProperties().tickTime;if(p._c.enabled){if(p._c.sustain&&t._c){a();var r=0,o=p._c.points[p._c._H];o&&(r=o[0]*n);for(var i=p._c._H;i<p._c.count;i++){var s=p._c.points[i];s&&t._c.gain.linearRampToValueAtTime(s[1]/64,e+s[0]*n-r)}}if(p.fadeout)t._X.gain.linearRampToValueAtTime(0,e+65536/p.fadeout*n/2)}else a(),t._X.gain.linearRampToValueAtTime(0,e+.1);if(p._d.enabled&&ye.usePanning&&t._d)for(r=0,(o=p._d.points[p._d._H])&&(r=o[0]*n),i=p._d._H;i<p._d.count;i++)(s=p._d.points[i])&&t._d.pan.linearRampToValueAtTime((s[1]-32)/32,e+s[0]*n-r);return 100}if(a(),!t.isKey||!t.volume)return 0;t.volume.gain.linearRampToValueAtTime(0,e+.5)}},p.scheduleEnvelopeLoop=function(e,t,a,n){n=n||0;var r=Ae.getProperties().tickTime;if(e.gain)var o=p._c,i=e.gain,s=0,u=64;else o=p._d,i=e.pan,u=s=32;var _=o.points[o._w],l=_[0];if(o.loop&&o._w<o._J)for(;n<a;)for(var c=n,f=o._w;f<=o._J;f++)i.linearRampToValueAtTime(((_=o.points[f])[1]-s)/u,t+(n=c+(_[0]-l)*r));return n},p.scheduleAutoVibrato=function(e,t){var a=0;e.scheduled.ticks=e.scheduled.ticks||0;var n,r,o,i,s=Ae.getProperties().tickTime,u=-p._p.rate/40,_=p._p.depth/8;for(Ae._s&&(_*=4),e.source&&(n=e._U,r=e.scheduled._pFunction||ye._r.sine,o=e.scheduled._p||ye.context.currentTime,i=0);a<t;){if(a+=s,n){var l=1;p._p.sweep&&e.scheduled.ticks<p._p.sweep&&(l=1-(p._p.sweep-e.scheduled.ticks)/p._p.sweep);var c=r(n,e.scheduled.ticks,u,_*l);Ae.setPeriodAtTime(e,c,o+i*s),i++}e.scheduled.ticks++}return a},p._D=function(){switch(p._p.type){case 1:return ye._r.square;case 2:return ye._r.saw;case 3:return ye._r.sawInverse}return ye._r.sine},p.resetVolume=function(e,t){if(t._X&&(t._X.gain.cancelScheduledValues(e),t._X.gain.setValueAtTime(1,e)),t._c){t._c.gain.cancelScheduledValues(e);var a=Ae.getProperties().tickTime,n=p._c.sustain?p._c._H+1:p._c.count;t._c.gain.setValueAtTime(p._c.points[0][1]/64,e);for(var r=1;r<n;r++){var o=p._c.points[r];t._c.gain.linearRampToValueAtTime(o[1]/64,e+o[0]*a)}}},p._G=function(){return Ae._j()?p.sample.finetuneX:p.sample.finetune},p.setFineTune=function(e){Ae._j()?(p.sample.finetuneX=e,p.sample.finetune=e>>4):(7<e&&(e-=16),p.sample.finetune=e,p.sample.finetuneX=e<<4)},p._O=function(e,t){var a=0;return Ae._s?(a=7680-64*(e-1),t&&(a-=p._G()/2)):(a=Pe[e]._b,t&&p._G()&&(a=ye._E(e,p._G()))),a},p.setSampleForNoteIndex=function(e){var t=p._z[e-1];t!==p.sampleIndex&&"number"==typeof t&&p.setSampleIndex(t)},p.setSampleIndex=function(e){p.sampleIndex!==e&&(p.sample=p.samples[e],p.sampleIndex=e,be._o(a,p._q))},p.hasSamples=function(){for(var e=0,t=p.samples.length;e<t;e++)if(p.samples[e].length)return!0},p.hasVibrato=function(){return p._p.rate&&p._p.depth},p},I=function(){var r={data:[],length:0,_a:"",bits:8,volume:64,finetune:0,finetuneX:0,panning:0,relativeNote:0,loop:{enabled:!1,start:0,length:0,type:0},check:function(){for(var e=0,t=0,a=0,n=r.data.length;a<n;a++)e=Math.min(e,r.data[a]),t=Math.max(t,r.data[a]);return{min:e,max:t}}};return r},Ve=function(){var a={_b:0,index:0,effect:0,_u:0,_i:0,_T:0,setPeriod:function(e){a._b=e,a.index=xe[e]||0},setIndex:function(e){var t=Pe[a.index=e];t?(a._b=t._k||t._b,1===a._b&&(a._b=0)):a._b=0},clear:function(){a._u=0,a._b=0,a.effect=0,a._i=0,a.index=0,a._T=0},duplicate:function(){return{_u:a._u,_b:a._b,effect:a.effect,_i:a._i,_T:a._T,note:a.index}},populate:function(e){a._u=e._u||0,a._b=e._b||0,a.effect=e.effect||0,a._i=e._i||0,a._T=e._T||0,a.index=e.note||e.index||0}};return a};return{init:Ae.init,load:Ae.load,playSong:Ae.playSong,stop:Ae.stop,togglePlay:Ae.togglePlay,isPlaying:Ae.isPlaying,getTrackCount:Ae.getTrackCount,getSong:Ae.getSong,getStateAtTime:Ae.getStateAtTime,getTimeStates:Ae.getTimeStates,setCurrentSongPosition:Ae.setCurrentSongPosition,setBPM:Ae.setBPM,getBPM:Ae.getBPM,_x:Ae._x,getAmigaSpeed:Ae.getAmigaSpeed,setMaster:Ae.setMaster,isMaster:Ae.isMaster,audio:ye}};"undefined"!=typeof HostBridge&&HostBridge.customConfig||(BassoonTracker=BassoonTracker());